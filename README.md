# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар (интерфейс используется и для попапа с товаром, по скольку включает в себя те же данные)

```
interface IProduct {
  id: string;
  description: string;
  images: string;
  title: string;
  category: string;
  price: number | null;
}
```

Покупатель

```
interface IUser {
  payment: 'card' | 'cash' | '';
  address: string;
  email: string;
  phone: string;
}
```

Корзина

```
interface IBasket {
  products: IProduct[];  // берём массив карточек товаров
  total: number | null; // если товаров нет, то итоговая сумма null
}
```

Попап формы с выборомом способа оплаты и адресом при покупке товара

```
type FormAddress = Pick<IUser, 'payment' | 'address'>;
```

Попап формы с контактами (почта и телефон) при покупке товара

```
type FormContacts = Pick<IUser, 'email' | 'phone'>;
```

Итоговый попап с подтверждением покупки товара(ов)

```
type FormSuccess = Pick<IBasket, 'total'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных


#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров.\
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов товаров
- _preview: string | null - id карточки товара, выбранного для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getProducts(): IProduct[] - возвращает список товаров
- setProduct(product: IProduct) - сохраняет выбранную карточку
- getProduct(id: string): IProduct - получить выбранную карточку


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс ProductModel
Класс отвечает за хранение данных о выбранном товаре.
В полях класса хранятся следующие данные:
- _product: IProduct - хранит все данные о товаре согласно интерфейсу.

Так же предоставляет набор методов для взаимодействия с этими данными:
- getId(): string - возвращает идентификатор товара
- getDescription(): string - возвращает описание товара
- getImages(): string - возвращает изображение товара
- getTitle(): string - возвращает название товара
- getCategory(): string - возвращает категорию(группу) товара
- getPrice(): number | null - возвращает цену если она есть


#### Класс BasketModel
Класс отвечает за хранение данных в корзине
В полях класса хранятся следующие данные:
- products: IProduct[] - хранит товары в корзине
- total: number | null - хранит общую стоимость товаров, либо null(в случае если товаров нет)

Так же предоставляет набор методов для взаимодействия с этими данными:
- getAddProduct(product: IProduct):void - добавляет товар в корзину;
- getRemoveProduct(id: string):void - удаляет товар из корзины по id;
- getTotal():number - обновляет информацию об общей сумме товаров в корзине


### Слой отображения

#### Класс Page
Класс Page отвечает за отображение всей главной страницы. В его задачи входит управление контейнером для карточек, кнопкой корзины и счетчиком товаров.
-	catalog: HTMLElement — контейнер для карточек товаров.
- basketCounter: HTMLElement — контейнер счётчика товаров в корзине.
- basketButton: HTMLButtonElement — кнопка для открытия корзины.
Методы:
-	renderCatalog(product: HTMLElement[]): void — отображает содержимое каталога на страницу.
-	renderBasket(count: number): void — отображет количество товаров в корзине.

#### Класс ProductView
Класс ProductView отвечает за отображение одной карточки с товаром. Наследуется от Component. Поддерживает набор данных IProduct.
Методы:
Сеттеры будут изменять значения:
- id - id карточки
- description - описание карточки
- images - картинку карточки
- title - название карточки
- category - группу товаров карточки
- price? - её цену, либо null.

#### Класс BasketView
Класс BasketView отвечает за отображение корзины с товарами. Аналогично классу ProductView будет насловаться от Component. Поддерживает набор данных IBasket. В конструкторе будет необходим EventEmmiter для взаимодействия с кнопкой
_products - массив товаров
_total - итоговая сумма
_buttonSubmit - кнопка сабмита

Методы:
Сеттеры будут изменять следующие значения:
products - Массив товаров добавленных в корзину( в случае если корзина пустая textContent(у 'p'): 'Корзина пуста')
total - Общая сумма товаров в корзине, либо null в случае отсутствия в ней товаров.
buttonSubmit - изменяет состояние кнопки в зависимости от наличия(отсутсвия) товаров.


#### Класс Modal
Общий класс для модальных окон(!). Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на кнопку-крестик для закрытия попапа.  
Поля класса
- buttonClose - кнопка закрытия попапа по крестику
- buttonSubmit - кнопка сабмита в попапе
Методы:
- open(открытие попапа) и close(закрытие попапа);

#### Класс Form
Общий класс для форм. Реализует попап с формой. 
Поля класса:
- button: <HTMLButtonElement> - кнопка сабмита в форме
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: <HTMLElement> - текст ошибки в случае невалидности
Методы:
- set valid(isValid: boolean) - проверяет валидность, переводит состояние кнопки в активную/не активную
- set error(isValid: string) - проверяет валидность, выводит текст с ошибкой.

#### Класс FormAddress
Класс для формы с полями способа оплаты и адреса. Наследует класс формы
Поля класса:
- buttonCash - кнопка выбора оплаты наличными
- buttonCard -  кнопка выбора оплаты картой
Сеттеры устанавливают значения для поля адреса и для способа оплаты.

#### Класс FormContacts
Класс для формы с полями почты и телефона. Наследует класс формы, с одной поправкой на наличие сеттеров для почты покупателя и телефона.

#### Класс FormSuccess
Класс для итоговой формы с завершение заказа. наследует класс формы. Присутствует только один сеттер для установки итоговой суммы заказа(total).


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
События с картами:
- product:select - выбор карточки товара при нажатии на него
- products:changed - изменение массива с товарами

События с корзиной:
- basket:open - открытие корзины
- basket:close - закрытие корзины
- basket:changed - измнение количества товаров в корзине

События с формой:
- form:open - отрытие формы
- form:close - закрытие формы
- form:firstStap - изменения в первой форме с адресом и способом оплаты
- form:secondStep - изменения во второй форме с контатами покупателя
- form:success - финальная форма с итоговой суммой после заполнения всех полей

События с остальными модальными окнами:
- modal:open - открытие модального окна
- modal:close - закрытие модального окна